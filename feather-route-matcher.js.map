{"version":3,"file":"feather-route-matcher.js","sources":["index.js"],"sourcesContent":["// regexes borrowed from backbone\nvar optionalParam = /\\((.*?)\\)/g\nvar namedParam = /(\\(\\?)?:\\w+/g\n// eslint-disable-next-line no-useless-escape\nvar escapeRegExp = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g\nvar splatParam = /\\*/g\n\n// Parses a URL pattern such as `/users/:id`\n// and builds and returns a regex that can be used to\n// match said pattern. Credit for these\n// regexes belongs to Jeremy Ashkenas and the\n// other maintainers of Backbone.js\n//\n// It has been modified for extraction of\n// named paramaters from the URL\nfunction parsePattern (pattern) {\n  var names = []\n  pattern = pattern\n    .replace(escapeRegExp, '\\\\$&')\n    .replace(optionalParam, '(?:$1)?')\n    .replace(namedParam, function (match, optional) {\n      names.push(match.slice(1))\n      return optional ? match : '([^/?]+)'\n    })\n    .replace(splatParam, function (match, optional) {\n      names.push('path')\n      return '([^?]*?)'\n    })\n\n  return {\n    regExp: new RegExp('^' + pattern + '(?:\\\\?([\\\\s\\\\S]*))?$'),\n    namedParams: names\n  }\n}\n\nexport default function (routes, fallback) {\n  var keys = Object.keys(routes)\n\n  // loop through each route we're\n  // and build the shell of our\n  // route cache.\n  for (var item in routes) {\n    if (routes.hasOwnProperty(item)) {\n      routes[item] = {\n        value: routes[item]\n      }\n    }\n  }\n\n  // main result is a function that can be called\n  // with the url\n  return function (url) {\n    var params\n    var route\n\n    // start looking for matches\n    var matchFound = keys.some(function (key) {\n      var parsed\n\n      // fetch the route pattern from the cache\n      // there will always be one\n      route = routes[key]\n\n      // if the route doesn't already have\n      // a regex we never generated one\n      // so we do that here lazily.\n      // Parse the pattern to generate the\n      // regex once, and store the result\n      // for next time.\n      if (!route.regExp) {\n        parsed = parsePattern(key)\n        route.regExp = parsed.regExp\n        route.namedParams = parsed.namedParams\n        route.pattern = key\n      }\n\n      // run our cached regex\n      var result = route.regExp.exec(url)\n\n      // if null there was no match\n      // returning falsy here continues\n      // the `Array.prototype.some` loop\n      if (!result) {\n        return\n      }\n\n      // remove other cruft from result\n      result = result.slice(1, -1)\n\n      // reduce our match to an object of named paramaters\n      // we've extracted from the url\n      params = result.reduce(function (obj, val, index) {\n        if (val) {\n          obj[route.namedParams[index]] = val\n        }\n        return obj\n      }, {})\n\n      // stops the loop\n      return true\n    })\n\n    // no routes matched\n    if (!matchFound) {\n      if (fallback) {\n        return {\n          page: fallback,\n          url: url,\n          params: null\n        }\n      }\n      return null\n    }\n\n    return {\n      page: route.value,\n      params: params,\n      url: url,\n      pattern: route.pattern\n    }\n  }\n}\n"],"names":[],"mappings":"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"}